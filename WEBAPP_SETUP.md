# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Telegram Web App

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **Backend API** - —Å–æ–∑–¥–∞–Ω—ã REST endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
‚úÖ **Frontend** - —Å–æ–∑–¥–∞–Ω–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ HTML/CSS/JS
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤ –±–æ—Ç–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è Web App

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
VPNbot/
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ webapp_handlers.py          # –ù–æ–≤—ã–π —Ñ–∞–π–ª - API –¥–ª—è Web App
‚îú‚îÄ‚îÄ webapp/                          # –ù–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ index.html                   # HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ styles.css                   # –°—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ app.js                       # JavaScript –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Web App
‚îú‚îÄ‚îÄ main.py                          # –û–±–Ω–æ–≤–ª–µ–Ω - –¥–æ–±–∞–≤–ª–µ–Ω—ã routes
‚îú‚îÄ‚îÄ keyboards.py                     # –û–±–Ω–æ–≤–ª–µ–Ω - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ Web App
‚îî‚îÄ‚îÄ database/db_commands.py          # –û–±–Ω–æ–≤–ª–µ–Ω - –¥–æ–±–∞–≤–ª–µ–Ω subscription_token
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö

### 1. `main.py`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `webapp_handlers`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `Path` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã API endpoints:
  - `GET /api/webapp/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
  - `GET /api/webapp/user` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `webapp/`

### 2. `keyboards.py`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `WebAppInfo`
- –í —Ñ—É–Ω–∫—Ü–∏—é `get_main_menu_kb()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üì± –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å (Web App)"
- –ö–Ω–æ–ø–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–ª—é—á–∞–º–∏

### 3. `database/db_commands.py`
- –í —Ñ—É–Ω–∫—Ü–∏—é `get_user_stats_detailed()` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `Keys.c.subscription_token`

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω

```bash
python main.py
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Web App

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:8080/webapp/index.html
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –≤–∞—à WEBHOOK_HOST:
```
https://your-domain.com/webapp/index.html
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl http://localhost:8080/api/webapp/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```json
{"status": "ok"}
```

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –±–æ—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–ª—é—á–∏, –≤—ã —É–≤–∏–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì± –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å (Web App)"
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Web App

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Å—ã–ª–∫—É:
```
https://t.me/YOUR_BOT_USERNAME?startapp=webapp
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BotFather –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Web App URL.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ BotFather (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã Web App –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ "Bot Settings" ‚Üí "Menu Button"
5. –í—ã–±–µ—Ä–∏—Ç–µ "Configure menu button"
6. –í–≤–µ–¥–∏—Ç–µ URL: `https://your-domain.com/webapp/index.html`
7. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Web App

### –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

1. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –ò–º—è
   - Username
   - –ê–≤–∞—Ç–∞—Ä (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏)

2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
   - –í—Å–µ–≥–æ –∫–ª—é—á–µ–π
   - –ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π
   - –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –¥–µ–Ω–µ–≥

3. **–°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π:**
   - –¢–∏–ø (–ø—Ä–æ–±–Ω—ã–π/–ø–ª–∞—Ç–Ω—ã–π)
   - –°—Ç—Ä–∞–Ω–∞ –∏ —Ñ–ª–∞–≥
   - –°—Ç–∞—Ç—É—Å (–∞–∫—Ç–∏–≤–µ–Ω/–∏—Å—Ç—ë–∫)
   - –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
   - –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –ø–æ –∫–ª–∏–∫—É)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã Telegram
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–ª—é—á–µ–π (–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–≤–µ—Ä—Ö—É)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Web App –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é `initData` –æ—Ç Telegram:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HMAC-SHA256 –ø–æ–¥–ø–∏—Å–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–Ω–µ —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞)
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## Troubleshooting

### Web App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `WEBHOOK_HOST` –≤ `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS (Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è Web Apps)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ "Invalid initData"

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `BOT_TOKEN` –≤ `.env` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Web App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Telegram, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–ª—é—á–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–ª—é—á–∏ –≤ –ë–î
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API endpoint `/api/webapp/user`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—à–∏–±–æ–∫ JavaScript

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∫—É–ø–∫—É VPN –ø—Ä—è–º–æ –∏–∑ Web App
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã –∏ —Ç–∞—Ä–∏—Ñ–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É (—á–∞—Ç —Å –∞–¥–º–∏–Ω–æ–º)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ –±–æ—Ç–∞ (`main.py`)
2. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. Network tab –≤ DevTools –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤

